# WordPress Backup & Restore Script

Скрипт для автоматизации создания и восстановления резервных копий WordPress сайтов с использованием WP-CLI. Этот инструмент позволяет легко создавать полные резервные копии (файлы и база данных) с минимальными усилиями.

## Содержание

- [Возможности](#возможности)
- [Требования](#требования)
- [Установка](#установка)
- [Использование](#использование)
  - [Создание резервной копии](#создание-резервной-копии)
  - [Восстановление из резервной копии](#восстановление-из-резервной-копии)
  - [Просмотр списка резервных копий](#просмотр-списка-резервных-копий)
- [Формат резервной копии](#формат-резервной-копии)
- [Часто задаваемые вопросы](#часто-задаваемые-вопросы)
- [Устранение неполадок](#устранение-неполадок)
- [Лицензия](#лицензия)

## Возможности

- **Полное резервное копирование** - сохранение файлов WordPress и базы данных
- **Выборочное копирование** - возможность исключить директорию uploads для экономии места
- **Метаданные** - хранение информации о версии WordPress, плагинах и темах
- **Гибкие параметры** - настройка директории для хранения резервных копий
- **Восстановление** - простое восстановление сайта из резервной копии
- **Обработка URL** - автоматическое обновление URL-адресов сайта при восстановлении
- **Список бэкапов** - удобный просмотр доступных резервных копий с информацией о размере и дате создания

## Требования

- Установленный [WP-CLI](https://wp-cli.org/)
- Bash (версия 4.0 или выше)
- Утилиты `tar` и `gzip`
- Права на чтение/запись в директории WordPress
- Доступ к командной строке на сервере

## Установка

1. Скачайте скрипт в корневую директорию вашего WordPress сайта:

```bash
wget https://github.com/wpadmin/wp-backup.sh -O backup-wp.sh
```

2. Сделайте скрипт исполняемым:

```bash
chmod +x backup-wp.sh
```

3. Убедитесь, что WP-CLI установлен и работает корректно:

```bash
wp --info
```

## Использование

### Создание резервной копии

Базовая команда для создания резервной копии:

```bash
./backup-wp.sh backup
```

**Дополнительные параметры:**

- `--dir=/путь/к/директории` - указать директорию для сохранения резервной копии (по умолчанию: `./wp-content/backups`)
- `--no-uploads` - исключить директорию uploads из резервной копии

**Примеры:**

```bash
# Создать полную резервную копию с сохранением в директории по умолчанию
./backup-wp.sh backup

# Создать резервную копию без uploads
./backup-wp.sh backup --no-uploads

# Создать резервную копию в указанной директории
./backup-wp.sh backup --dir=/home/user/backups
```

### Восстановление из резервной копии

Для восстановления WordPress из резервной копии:

```bash
./backup-wp.sh restore --file=/путь/к/файлу/wp_backup_ДАТА.tar.gz
```

При восстановлении скрипт выполнит следующие действия:
1. Распакует архив резервной копии
2. Восстановит базу данных
3. Восстановит файлы WordPress
4. Очистит кэш WordPress
5. При необходимости предложит обновить URL-адреса сайта

> **ВНИМАНИЕ!** Восстановление перезапишет текущую базу данных и файлы WordPress. Рекомендуется создать дополнительную резервную копию перед восстановлением.

### Просмотр списка резервных копий

Для просмотра списка доступных резервных копий:

```bash
./backup-wp.sh list
```

**Дополнительные параметры:**

- `--dir=/путь/к/директории` - указать директорию для поиска резервных копий (по умолчанию: `./wp-content/backups`)

**Пример:**

```bash
./backup-wp.sh list --dir=/home/user/backups
```

## Формат резервной копии

Резервные копии сохраняются в формате `.tar.gz` и содержат:

- **database.sql** - дамп базы данных WordPress
- **wp-files.tar.gz** - архив файлов WordPress
- **backup_info.txt** - информация о резервной копии (версия WordPress, список плагинов, тем и т.д.)

Имя файла резервной копии имеет формат: `wp_backup_ГГГГ-ММ-ДД_ЧЧ-ММ-СС.tar.gz`

## Часто задаваемые вопросы

### Как часто следует создавать резервные копии?

Рекомендуемая частота зависит от активности на сайте:
- Для активных блогов/интернет-магазинов: ежедневно
- Для сайтов со средней активностью: 1-2 раза в неделю
- Для статичных сайтов: 1-2 раза в месяц или после внесения изменений

### Можно ли автоматизировать создание резервных копий?

Да, вы можете добавить скрипт в планировщик задач (cron):

```bash
# Пример ежедневного резервного копирования в 03:00
0 3 * * * cd /путь/к/wordpress && ./backup-wp.sh backup > /dev/null 2>&1
```

### Как восстановить только базу данных?

Для восстановления только базы данных, вы можете:
1. Распаковать архив резервной копии вручную
2. Использовать извлеченный файл database.sql для импорта:
   ```bash
   wp db import /путь/к/database.sql
   ```

## Устранение неполадок

### Скрипт выдает ошибку "WP-CLI не установлен"

Убедитесь, что WP-CLI установлен глобально и доступен в системе. Для установки следуйте инструкциям на [официальном сайте WP-CLI](https://wp-cli.org/).

### Ошибка прав доступа при создании резервной копии

Убедитесь, что пользователь, от имени которого запускается скрипт, имеет права на чтение файлов WordPress и запись в директорию для резервных копий.

### Ошибка при восстановлении базы данных

Убедитесь, что пользователь базы данных имеет необходимые привилегии. Также проверьте соответствие версий MySQL/MariaDB в среде, где была создана резервная копия, и среде, где выполняется восстановление.

## Лицензия

Этот скрипт распространяется под лицензией MIT. Вы можете свободно использовать, изменять и распространять его при условии сохранения уведомления об авторских правах.
